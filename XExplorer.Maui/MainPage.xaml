<?xml version="1.0" encoding="utf-8"?>

<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:vm="clr-namespace:XExplorer.Core.ViewModel;assembly=XExplorer.Core"
             xmlns:fa="clr-namespace:UraniumUI.Icons.MaterialIcons;assembly=UraniumUI.Icons.MaterialIcons"
             x:Class="XExplorer.Maui.MainPage">
    <ContentPage.BindingContext>
        <vm:MainViewModel />
    </ContentPage.BindingContext>
    <VerticalStackLayout Margin="10" x:Name="MainGrid">
        <!-- 遮罩层 -->
        <Grid IsVisible="{Binding IsShow}" BackgroundColor="#80000000">
            <!-- 弹窗 -->
            <Frame BackgroundColor="Moccasin"
                   Padding="20"
                   CornerRadius="10"
                   VerticalOptions="Center"
                   HorizontalOptions="Center"
                   WidthRequest="300">
                <VerticalStackLayout>
                    <Label Text="{Binding Message}" TextColor="Black" HorizontalOptions="Center" />
                    <Button Text="关闭" Command="{Binding CloseNotificationCommand}" StyleClass="ElevatedButton" />
                </VerticalStackLayout>
            </Frame>
        </Grid>
        <HorizontalStackLayout>
            <Label HorizontalTextAlignment="Start" VerticalTextAlignment="Center" Text="目录：" />
            <Picker SelectedItem="{Binding SelectedDir}"
                    ItemsSource="{Binding Dirs}"
                    ItemDisplayBinding="{Binding Name}"
                    HorizontalTextAlignment="Start"
                    HorizontalOptions="StartAndExpand"
                    MinimumWidthRequest="400" />

            <Button Text="加载" ToolTipProperties.Text="懒加载" Command="{Binding LoadDirCommand}" StyleClass="ElevatedButton" />
            <Image>
                <Image.Source>
                    <FontImageSource FontFamily="FASolid" Glyph="{x:Static fa:MaterialSharp.Supervised_user_circle}" Color="Orange" />
                </Image.Source>
            </Image>
            <!-- <Button Text="全载" ToolTipProperties.Text="全部加载" Command="{Binding LoadAllDirsCommand}" MinimumWidthRequest="50" Margin="10,0"></Button> -->
            <!-- <Button Text="处理" ToolTipProperties.Text="视频处理" Command="{Binding ProcessVideosCommand}" MinimumWidthRequest="50" Margin="10,0"></Button> -->
            <!-- <Button Text="清源" ToolTipProperties.Text="清理原始目录" Command="{Binding DeleteOriginalCommand}" MinimumWidthRequest="50" Margin="10,0"></Button> -->
            <!-- <Button Text="日志" ToolTipProperties.Text="打开日志目录" Command="{Binding OpenLogDirCommand}" MinimumWidthRequest="50" Margin="10,0"></Button> -->
            <!-- <Button Text="数据" ToolTipProperties.Text="打开数据目录" Command="{Binding OpenDataDirCommand}" MinimumWidthRequest="50" Margin="10,0"></Button> -->
            <!-- <Button Text="清垃圾" ToolTipProperties.Text="清理数据目录不再使用的图片资源" Command="{Binding ClearInvalidDataDirCommand}" MinimumWidthRequest="50" Margin="10,0"></Button> -->
            <!-- <Button Text="删数据" ToolTipProperties.Text="删除选中目录的数据目录" Command="{Binding ClearDataCommand}" MinimumWidthRequest="50" Margin="10,0"></Button> -->
        </HorizontalStackLayout>
        <BoxView StyleClass="Divider" />
        <CollectionView ItemsSource="{Binding Videos}" x:Name="MainView" VerticalOptions="FillAndExpand"
                        HeightRequest="{Binding Source={x:Reference MainGrid}, Path=Height}">
            <CollectionView.ItemsLayout>
                <LinearItemsLayout Orientation="Vertical" />
            </CollectionView.ItemsLayout>
            <CollectionView.ItemTemplate>
                <DataTemplate>
                    <Border HeightRequest="450" HorizontalOptions="Start">
                        <VerticalStackLayout>
                            <HorizontalStackLayout HeightRequest="30">
                                <Label Text="{Binding Dir}" />
                            </HorizontalStackLayout>
                            <BoxView StyleClass="Divider" />
                            <HorizontalStackLayout HeightRequest="30">
                                <Label Text="{Binding Caption}" />
                                <Label Text="===" />
                                <Label Text="{Binding Length}" />
                                <Label Text="MB" />
                                <Label Text="===" />
                                <Label Text="{Binding PlayCount}" />
                                <Label Text="===" />
                                <Label Text="{Binding ModifyTime}" />
                                <Label Text="===" />
                            </HorizontalStackLayout>
                            <BoxView StyleClass="Divider" />
                            <CollectionView ItemsSource="{Binding Snapshots}" HeightRequest="310"
                                            HorizontalOptions="FillAndExpand">
                                <CollectionView.ItemsLayout>
                                    <LinearItemsLayout Orientation="Horizontal" />
                                </CollectionView.ItemsLayout>
                                <CollectionView.ItemTemplate>
                                    <DataTemplate>
                                        <!-- <Image Source="{Binding Path}" -->
                                        <!--        HeightRequest="300" -->
                                        <!--        WidthRequest="400"> -->
                                        <!-- </Image> -->
                                    </DataTemplate>
                                </CollectionView.ItemTemplate>
                            </CollectionView>
                            <HorizontalStackLayout HeightRequest="35"
                                                   HorizontalOptions="StartAndExpand"
                                                   VerticalOptions="CenterAndExpand">
                                <Button MinimumWidthRequest="150" Text="Play"
                                        Command="{Binding Source={RelativeSource AncestorType={x:Type vm:MainViewModel}}, Path=PlayCommand}"
                                        CommandParameter="{Binding VideoPath}" />
                                <Button MinimumWidthRequest="150" Text="Folder"
                                        Command="{Binding Source={RelativeSource AncestorType={x:Type vm:MainViewModel}}, Path=FolderCommand}"
                                        CommandParameter="{Binding VideoPath}" />
                                <!-- <Button MinimumWidthRequest="150" Text="Del"  -->
                                <!--         Command="{Binding Source={RelativeSource AncestorType={x:Type vm:MainViewModel}}, Path=DeleteCommand}" -->
                                <!--         CommandParameter="{Binding}" /> -->
                                <!-- <Button MinimumWidthRequest="150" Text="Del folder"  -->
                                <!--         Command="{Binding Source={RelativeSource AncestorType={x:Type vm:MainViewModel}}, Path=DeleteFolderCommand}" -->
                                <!--         CommandParameter="{Binding}" /> -->
                                <!-- <Button MinimumWidthRequest="150" Text="Reset"  -->
                                <!--         Command="{Binding Source={RelativeSource AncestorType={x:Type vm:MainViewModel}}, Path=ResetVideoCommand}" -->
                                <!--         CommandParameter="{Binding}" /> -->
                            </HorizontalStackLayout>
                        </VerticalStackLayout>
                    </Border>
                </DataTemplate>
            </CollectionView.ItemTemplate>
        </CollectionView>
    </VerticalStackLayout>
</ContentPage>